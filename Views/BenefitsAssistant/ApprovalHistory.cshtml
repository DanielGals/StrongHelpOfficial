@model BenefitsAssistantApplicationDetailsViewModel
@{
    ViewData["Title"] = "Approval History";
    ViewBag.IdParamName = "id";
    ViewBag.LoanID = Model.LoanID;
    ViewBag.Status = Model.ApplicationStatus;
    ViewBag.TabArea = "";
}

@section Styles {
    <link rel="stylesheet" href="~/css/LoanApplicationDetails.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/MyApplication.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/BenefitsAssistantApprovalHistory.css" asp-append-version="true" />
}

<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
    <div>
        <h2 class="fw-bold mb-1">Approval History</h2>
        <div class="text-muted mb-2" style="font-size:1em;">Current Status and details of your application</div>
    </div>
</div>

@{
    ViewBag.LoanID = Model.LoanID;
    ViewBag.Status = Model.ApplicationStatus;
}
@await Html.PartialAsync("_LoanApplicationTabs")

@if (Model.Approvers != null && Model.Approvers.Any())
{
    @foreach (var approval in Model.Approvers)
    {
        // Determine the color based on status
        var statusColor = approval.Status switch
        {
            "Approved" => "#28a745", // Green
            "Rejected" => "#dc3545", // Red
            "Reviewed" => "#17a2b8", // Blue
            _ => "#dc3545" // Default to red for pending
        };

        <div class="approval-history-item" style="border-left: 3px solid @statusColor; padding-left: 1rem; margin-bottom: 2rem;">
            <div class="loan-details-label" style="margin-bottom:0.1em; color: @statusColor; font-weight: bold;">
                @approval.RoleName @(approval.RoleName.Contains("Benefits Assistant") ? "Review" : "Approval")
            </div>
            <div>
                <span>
                    @approval.Status by @approval.UserName on @DateTime.Now.ToString("yyyy-MM-dd")
                </span>
                @if (!string.IsNullOrEmpty(approval.Description))
                {
                    <div class="approval-comments mt-2">
                        <i class="bi bi-chat-left-text"></i> @approval.Description
                    </div>
                }
            </div>
        </div>
    }
}

<!-- Application Submission -->
<div class="approval-history-submitted" style="border-left: 3px solid #3243c0; padding-left: 1rem; margin-bottom: 2rem;">
    <div class="loan-details-label" style="margin-bottom:0.1em;">Application Submitted</div>
    <div>
        <span>
            Submitted by @Model.EmployeeName on @Model.DateSubmitted.ToString("yyyy-MM-dd")
        </span>
    </div>
</div>
