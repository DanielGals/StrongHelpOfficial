@model ApproverApplicationDetailsViewModel

<!-- Application Decision -->
@if (Model.ApplicationStatus == "Submitted")
{
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h3 class="card-title">Application Decision</h3>
            <div class="subtitle-green">Review and make a decision on this application</div>
            <div class="alert-yellow">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24">
                        <polygon points="12,2 2,22 22,22" fill="none" stroke="#facc15" stroke-width="2" />
                        <line x1="12" y1="8" x2="12" y2="14" stroke="#facc15" stroke-width="2" />
                        <circle cx="12" cy="17" r="1.5" fill="#facc15" />
                    </svg>
                </span>
                <span>
                    <strong>Attention:</strong> Please complete the validation checklist before approving the application.
                </span>
            </div>
            <div class="action-buttons">
                <button id="approveApplicationBtn" type="button" class="btn btn-success btn-burger" disabled>Approve Application</button>
                <button id="rejectApplicationBtn" type="button" class="btn btn-outline-danger btn-burger">Reject Application</button>
                <div id="rejectCommentContainer" class="mt-3" style="display:none;">
                    <textarea id="rejectCommentBox" class="form-control mb-2" rows="3" style="resize: none;" placeholder="Enter reason for rejection"></textarea>
                    <button id="confirmRejectBtn" type="button" class="btn btn-danger">Confirm Reject</button>
                </div>
            </div>
        </div>
    </div>
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h3 class="card-title d-flex justify-content-between align-items-center">
                Validation Checklist
            </h3>
            <div id="checklistItemsContainer" class="mt-3"></div>
            <button id="addItemBtn" type="button" class="btn btn-success d-flex align-items-center mt-3 ms-auto" style="gap:0.5rem;">
                <span class="d-flex align-items-center justify-content-center" style="width:1.8em; height:1.8em;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" fill="white" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" fill="white" fill-opacity="0.2" />
                        <path d="M8 4.5a.75.75 0 0 1 .75.75v2a.25.25 0 0 0 .25.25h2a.75.75 0 0 1 0 1.5h-2a.25.25 0 0 0-.25-.25v2a.75.75 0 0 1-1.5 0v-2a.25.25 0 0 0-.25-.25h-2a.75.75 0 0 1 0-1.5h2a.25.25 0 0 0 .25-.25v-2A.75.75 0 0 1 8 4.5z" fill="white" />
                    </svg>
                </span>
                <span>Add Item</span>
            </button>
        </div>
    </div>
}
@* Display status info for non-editable states *@
@if (Model.ApplicationStatus != "Submitted")
{
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h3 class="card-title">Application Status</h3>
            <div class="subtitle-green">Current application information</div>
            
            @if (Model.ApplicationStatus == "In Review" || Model.ApplicationStatus == "Pending")
            {
                <div class="alert alert-info">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" fill="none" stroke="#0ea5e9" stroke-width="2" />
                            <line x1="12" y1="16" x2="12" y2="12" stroke="#0ea5e9" stroke-width="2" />
                            <line x1="12" y1="8" x2="12.01" y2="8" stroke="#0ea5e9" stroke-width="2" />
                        </svg>
                    </span>
                    <span>
                        <strong>Information:</strong> This application is currently being reviewed by the approval workflow.
                    </span>
                </div>
                
                @if (Model.Approvers != null && Model.Approvers.Any())
                {
                    <div class="mt-3">
                        <div class="fw-bold mb-2">Approval Progress:</div>
                        @{
                            var totalApprovers = Model.Approvers.Count(a => a.RoleName != "Benefits Assistant");
                            var approvedCount = Model.Approvers.Count(a => a.Status == "Approved" && a.RoleName != "Benefits Assistant");
                            var progressPercent = totalApprovers > 0 ? (approvedCount * 100 / totalApprovers) : 0;
                        }
                        <div class="progress mb-2" style="height: 20px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: @(progressPercent)%" 
                                 aria-valuenow="@progressPercent" aria-valuemin="0" aria-valuemax="100">
                                @approvedCount of @totalApprovers approved
                            </div>
                        </div>
                        <small class="text-muted">@progressPercent% complete</small>
                    </div>
                }
            }
            else if (Model.ApplicationStatus == "Approved")
            {
                <div class="alert alert-success">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" fill="none" stroke="#22c55e" stroke-width="2" />
                            <path d="m9 12 2 2 4-4" fill="none" stroke="#22c55e" stroke-width="2" />
                        </svg>
                    </span>
                    <span>
                        <strong>Approved:</strong> This application has been successfully approved.
                    </span>
                </div>
            }
            else if (Model.ApplicationStatus == "Rejected")
            {
                <div class="alert alert-danger">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" fill="none" stroke="#ef4444" stroke-width="2" />
                            <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2" />
                            <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2" />
                        </svg>
                    </span>
                    <span>
                        <strong>Rejected:</strong> This application has been rejected.
                    </span>
                </div>
            }
            
            <div class="mt-3">
                <div class="fw-bold mb-2">Current Status:</div>
                <div class="badge @(Model.ApplicationStatus switch { 
                    "Approved" => "bg-success", 
                    "Rejected" => "bg-danger", 
                    "In Review" => "bg-warning text-dark", 
                    "Pending" => "bg-warning text-dark", 
                    "Submitted" => "bg-primary",
                    _ => "bg-secondary" 
                }) px-3 py-2" style="font-size: 1em;">
                    @Model.ApplicationStatus
                </div>
            </div>
        </div>
    </div>
}

<!-- Modals for Application Decision -->
<!-- Modal for adding checklist item -->
<div class="modal fade" id="addChecklistItemModal" tabindex="-1" aria-labelledby="addChecklistItemModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addChecklistItemModalLabel">Add Checklist Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="conditionTextInput" class="form-control" placeholder="Enter checklist item" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="confirmAddChecklistBtn">Add</button>
                <button type="button" class="btn btn-info" id="fillPreexistingChecklistBtn">Fill with Pre-existing Checklist</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for reject confirmation -->
<div class="modal fade" id="rejectConfirmModal" tabindex="-1" aria-labelledby="rejectConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rejectConfirmModalLabel">Confirm Rejection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to reject this application?<br />
                <strong>Comment:</strong>
                <div id="rejectCommentPreview" class="border rounded p-2 mt-2 bg-light"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="finalRejectBtn">Yes, Reject</button>
            </div>
        </div>
    </div>
</div>
